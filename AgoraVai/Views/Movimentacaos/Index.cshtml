@model IEnumerable<AgoraVai.Models.Movimentacao>
@{
    /**/
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Movimentacao.cshtml";

}

@*<input style="height: 50px; width: 50%; text-align: center; background-color: #318aff; border-radius: 200px; font-size: 28px; color: black;" type="text" name="Pesquisa" placeholder="Pesquisar..." id="pesquisa" />*@

<h2 style="text-align:center; padding: 20px; font-size: 30px">Bem-Vindo(a), @ViewBag.nomedousuario</h2>

<section class="section--login">
    <div class="tabela--search__div">
        <i class="fas fa-search"></i>
        <input type="text" class="tabela--search" placeholder="Pesquisar placa...">
    </div>

    <table class="tabela tabela__up">
        <tr class="tabela--infos tabela__bold">
            <th>
                @Html.DisplayNameFor(model => model.Funcionario.Pessoa.Nome)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Vaga.Tipo)
            </th>
            <th>
                CPF
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Telefone)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Placa)
            </th>
            <th>
                Hora de entrada
            </th>
            <th>
                Tempo
            </th>
            <th>Finalizar</th>
            @*<th></th>*@
        </tr>


        @foreach (var item in Model)
        {
            <tr class="tabela--infos">
                <td>
                    @Html.DisplayFor(modelItem => item.Funcionario.Pessoa.Nome)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Vaga.Tipo)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Cpf)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Telefone)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Placa)
                </td>
                <td class="rds">
                    @Html.DisplayFor(modelItem => item.hora_entrada)
                </td>
                <td class="timer"></td>
                <td>
                    @Html.ActionLink("Finalizar", "Edit", new { id = item.Id }, new { @class = "btn btn--login btn__pattern btn--padding" })
                    @*@Html.ActionLink("Detalhes", "Details", new { id = item.Id })*@
                    @*@Html.ActionLink("Delete", "Delete", new { id = item.Id })*@
                </td>
            </tr>
        }

    </table>
</section>

<script>
    function searchFilter() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.querySelector('.tabela--search');
        filter = input.value.toUpperCase();
        table = document.querySelector('.tabela');
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[4];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    document.querySelector('.tabela--search').addEventListener('keyup', searchFilter);


    //CRONOMETRO
    //cria cronometro
    var tempos = [], oldDias = [], oldMeses = [], oldHoras = [], oldMinutos = [], oldSegundos = [];
    function tempoAntigo() {
        //pega tempo antigo separadamente
        for (var i = 0; i < document.querySelectorAll('.timer').length; i++) {
            var timeStamp = document.getElementsByClassName('rds')[i].innerHTML; //pega os valores do tempo de entrada
            tempos.push(timeStamp); //Adiciona o tempo atual da linha ao tempos array
            oldDias[i] = `${Array.from(tempos[i])[21] + Array.from(tempos[i])[22]}`;
            oldMeses[i] = `${Array.from(tempos[i])[24] + Array.from(tempos[i])[25]}`;
            oldHoras[i] = `${Array.from(tempos[i])[32] + Array.from(tempos[i])[33]}`;
            oldMinutos[i] = `${Array.from(tempos[i])[35] + Array.from(tempos[i])[36]}`;
            oldSegundos[i] = `${Array.from(tempos[i])[38] + Array.from(tempos[i])[39]}`;
        }
    }
    tempoAntigo();
    /*var cronometroDias = [], cronometroHoras = [], cronometroMinutos = [], cronometroSegundos = [];*/ //Pega horario toral do cronometro
    var cronometroDias = [],
        cronometroHoras = [],
        cronometroMinutos = [],
        Remainder = [];
    //pegar Hora atual
    setInterval(function () {
        // var data = new Date();
        //Display cronometro
        for (var i = 0; i < document.querySelectorAll('.timer').length; i++) {
            //exibe cronometro
            var print = new Date();

            var tempo = Number(((print.getHours() * 60) + print.getMinutes()));
            tempo = tempo - (Number((oldHoras[i] * 60)) + Number(oldMinutos[i]));

            if (tempo < 0) {
                tempo * -1;
            }

            console.log(Number((print.getHours() + print.getMinutes())));
            cronometroHoras[i] = 0;
            cronometroMinutos[i] = tempo;
            for (var j = tempo; j >= 60; j -= 60) {
                cronometroHoras[i] += 1;
                cronometroMinutos[i] = j - 60;
            }

            document.getElementsByClassName("timer")[i].innerHTML = `${cronometroHoras[i]}:${cronometroMinutos[i]}`;
        }


    }, 1000);
    //CRONOMETRO



</script>









